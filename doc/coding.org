#+title: Coding Ouinet

* Introduction

This document provides an overview of how the Ouinet source directory is structured, the main conventions and generic helper modules used in it, and the main Ouinet classes in the library and their roles.

*Note:* Links to source files and directories are relative to this document, while their texts are relative to the source code root.

*Note:* This is work in progress and intended as a very rough introduction to Ouinet source code, so expect some divergences between this document and the source.  Please contact mailto:ouinet@equalit.ie if you find misguiding content in this document, thanks!

* Directory structure

** Documentation

The [[file:.][doc/]] directory contains assorted documents about Ouinet:

- [[file:coding.org][doc/coding.org]]: this file
- [[file:ouinet-network-whitepaper.md][doc/ouinet-network-whitepaper.md]]: a technical description of how Ouinet works and its associated protocols; any implementation should ideally stick to this reference
- [[file:request-response-flow.svg][doc/request-response-flow.svg]]: a detailed diagram of how requests and responses travel over different Ouinet components (esp. within the client)
- [[file:android-sdk-versions.md][doc/android-sdk-versions.md]]: some clarifications on the chosen versions of Android SDK and API levels
- [[file:arch-drafts][doc/arch-drafts/]]: documents where particular parts of Ouinet specs are developed (they should but they might not match the white paper completely)

** Build system

Ouinet uses [[https://cmake.org/][CMake]] to build its source:

- [[file:../CMakeLists.txt][CMakeLists.txt]] is the main entry point to the CMake build configuration:
  - checks the version of CMake and some generic build flags
  - builds the Ouinet library and project-developed dependencies (imported as submodules)
  - builds the client & injector programs
  - builds test programs and tools
- [[file:../cmake][cmake/]] contains more specific CMake configuration snippets:
  - [[file:../cmake/OuinetDependencies.cmake][cmake/OuinetDependencies.cmake]]: the build configuration of third-party dependencies (under the [[file:../cmake/dependencies][cmake/dependencies/]] subdirectory)
  - [[file:../cmake/BuildVersion.cmake][cmake/BuildVersion.cmake]]: machinery to extract the release version (from [[file:../version.txt][version.txt]], which follows [[https://semver.org/][Semantic Versioning]]), compute a build identifier (=(Release|Debug) (HEAD|<branch name>) <Git commit>=), and make them available to source code

** Isolated build environments

Ouinet provides configuration files for different systems supporting isolated build environments, should you prefer not to pollute your main system with build dependencies:

- [[https://docker.io/][Docker]]: Files are provided to create a client/injector container image ([[file:../Dockerfile][Dockerfile]]), an image with dependencies to build the Android library ([[file:../Dockerfile.android][Dockerfile.android]]), and an image to run an Android emulator ([[file:../Dockerfile.android-emu][Dockerfile.android-emu]]). This is used for Docker Hub images. See [[file:../README.md][README.md]] for more information.
- [[https://vagrantup.com/][Vagrant]]: The [[file:../Vagrantfile][Vagrantfile]] can be used to build the Ouinet client, injector and tests. May be outdated. See [[file:../README.md][README.md]] for more information.
- [[https://guix.gnu.org/][GNU Guix]]: A Guix environment (either temporary or permanent) can be used to build the Ouinet client, injector and tests. See [[file:../guix/README.md][guix/README.md]] for more information.

** Scripts

The [[file:../scripts][scripts/]] directory contains scripts for assorted tasks:

- Building:
  - [[file:../scripts/build-ouinet-local.sh][scripts/build-ouinet-local.sh]] and [[file:../scripts/build-ouinet-git.sh][scripts/build-ouinet-git.sh]] can be invoked to build Ouinet from a local source checkout or from the Git repo (respectively) to =ouinet-local-build/= in the current directory.
  - [[file:../scripts/git-version-string.sh][scripts/git-version-string.sh]] is used by CMake to get versioning information from the Git checkout.
- Docker packaging:
  - [[file:../scripts/add-licenses-dir.sh][scripts/add-licenses-dir.sh]] includes dependency licensing information from [[file:../scripts/licenses][src/licenses/]] in the client/injector Docker container image.
  - [[file:../scripts/ouinet-wrapper.sh][scripts/ouinet-wrapper.sh]] acts as the container's entry point.
- Testing:
  - [[file:../scripts/run_integration_tests.sh][scripts/run_integration_tests.sh]] starts Ouinet's integration tests. Outdated, not working currently.
  - [[file:../scripts/firefox-proxy.sh][scripts/firefox-proxy.sh]] runs Firefox with a temporary session which uses a local Ouinet client as its HTTP proxy. Outdated.
  - [[file:../scripts/ping-swarm][scripts/ping-swarm]] can be used to ping nodes announcing themselves in a Ouinet swarm on BitTorrent. See comments in the script for more information.

** Android support

The [[file:../android][android/]] directory contains files used to build the Ouinet library for Android (AAR):

- [[file:../android/build.gradle][android/build.gradle]] and [[file:../android/settings.gradle][android/settings.gradle]] are the main configuration files for [[https://gradle.org/][Gradle]], with files under [[file:../android/build-scripts][android/build-scripts/]] being used for handling the publication to [[https://search.maven.org/][Maven Central]].
- [[file:../android/i2pd][android/i2pd/]] contains support for the [[https://geti2p.net/][I2P]] transport. Probably outdated.
- [[file:../android/ouinet][android/ouinet/]] contains the JNI wrapper source for the Ouinet native library, plus the high level =Config= and =Ouinet= Java classes for running a Ouinet client in Android.


# Local Variables:
# mode: org
# mode: visual-fill-column
# mode: visual-line
# mode: flyspell
# ispell-local-dictionary: "american"
# End:
